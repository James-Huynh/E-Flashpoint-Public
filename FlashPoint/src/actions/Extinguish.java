package actions;

// Start of user code for imports
import java.util.*;
// End of user code

import game.GameState;
import token.Firefighter;
import tile.Tile;
import edge.Edge;

/**
 * Extinguish class definition.
 * Generated by the TouchCORE code generator.
 * and modified by @matekrk
 */
public class Extinguish extends Action {
    
    protected int direction;
    
    public Extinguish() {
    	this.APcost = 1;
    }
    
    public Extinguish(int cost) {
    	this.APcost = cost;
    }
    
    /*
     * GETTERS
     */
    
    public int getDirection() {
        return direction;
    }

    /*
     * @OVERRIDE
     */
    
    @Override
    public boolean validate(GameState gs) {
        boolean flag = false;
        Firefighter playingFirefighter = gs.getPlayingFirefighter();
        int aP = playingFirefighter.getAP();
        Tile currentPosition = playingFirefighter.getCurrentPosition();
        Tile neighbour = gs.getNeighbour(currentPosition, this.direction);
        Edge edge = currentPosition.getEdge(this.direction);
        int fire = neighbour.getFire();
        int cost = super.getCost();
        
        if (fire >= 1 && fire <= cost) {
            if (currentPosition.equals(neighbour)) { //in other words: direction -1
                if (aP >= cost) {
                    flag = true;
                }
            }
        } 
        else {
        	if (edge.isBlank()) {
                if (aP >= cost) {
                    flag = true;
                }
        	}
        	else if (edge.isDoor()) {
                boolean status = edge.getStatus();
                if (status == true) {
                    if (aP >= cost) {
                        flag = true;
                    }
                }
            } 
        	else if (edge.isWall()) { 
                int damage = edge.getDamage();
                if (damage == 0) {
                    if (aP >= cost) {
                        flag = true;
                    }
                }
            }
        }
        return flag;
    }

    @Override
    public void perform(GameState gs) {
        Firefighter playingFirefighter = gs.getPlayingFirefighter();
        int aP = playingFirefighter.getAP();
        playingFirefighter.setSavedAP(aP-this.APcost);
        Tile currentPosition = playingFirefighter.getCurrentPosition();
        Tile neighbour = gs.getNeighbour(currentPosition, direction);
        neighbour.setFire(this.APcost);
    }

	@Override
	public String toString() {
		return "Extinguish [direction=" + direction + "]";
	}
    
    
}
