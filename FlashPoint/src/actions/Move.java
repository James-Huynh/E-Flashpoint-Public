package actions;

import edge.Edge;
import game.GameState;
import tile.Tile;
import token.Firefighter;
import token.POI;

/**
 * Move class definition.
 * Generated by the TouchCORE code generator.
 * and modified by @matekrk
 */
public class Move extends Action {
    
    protected int direction;
    
    public int getDirection() {
        return direction;
    }

    @Override
    public boolean validate(GameState gs) {
        boolean flag = false;
        Firefighter playingFirefighter = gs.getPlayingFirefighter();
        Tile currentPosition = playingFirefighter.getCurrentPosition();
        Edge edge = currentPosition.getEdge(direction);
        Tile neighbour = gs.getNeighbour(currentPosition, direction);
       
        if ( edge.isDoor() ) {
        	boolean status = edge.getStatus();
        	if(status == true) {
        		int fire = neighbour.getFire();
        		int aP = playingFirefighter.getAP();
        		if (fire < 2) {
        			if (playingFirefighter.getCarrying() == true && aP >= 2) {
        				flag = true;
        			}
        		}
        	}
        }
        return flag;
    }

    @Override
    public void perform(GameState gs) {
        Firefighter playingFirefighter = gs.getPlayingFirefighter();
        Tile currentPosition = playingFirefighter.getCurrentPosition();
        int aP = playingFirefighter.getAP();
        playingFirefighter.setSavedAP(aP - this.APcost);
        Tile neighbour = gs.getNeighbour(currentPosition, this.direction);
        playingFirefighter.setCurrentPosition(neighbour);
        boolean carrying = playingFirefighter.getCarrying();
        if (carrying == true) {
        	currentPosition.removeFromPoiList( playingFirefighter.getVictim() );
        	neighbour.addPoi( playingFirefighter.getVictim() );
        }
    }
}
